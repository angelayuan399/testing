<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Temperature Increase Visualization | CMIP6 Climate Data</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
<<<<<<< HEAD
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        main {
            padding: 30px;
        }

        .visualization-container {
            background: #f8fafc;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        #map-container {
            position: relative;
            width: 100%;
            margin-bottom: 30px;
        }

        svg {
            width: 100%;
            height: auto;
            display: block;
        }

        .controls {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .slider-container {
            margin-bottom: 20px;
        }

        .slider-container label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #2d3748;
        }

        #current-year {
            color: #667eea;
            font-size: 1.3em;
            font-weight: bold;
        }

        #year-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #FFFFCC, #FD8D3C, #BD0026);
            outline: none;
            -webkit-appearance: none;
            margin: 15px 0;
        }

        #year-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }

        #year-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        #year-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .year-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #718096;
            margin-top: 5px;
        }

        .play-btn {
            width: 100%;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .play-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
        }

        .play-btn:active {
            transform: translateY(0);
        }

        .legend {
            margin-top: 30px;
            text-align: center;
        }

        .legend h3 {
            margin-bottom: 15px;
            color: #2d3748;
        }

        .chart-container {
            background: #f8fafc;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .chart-container h2 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .chart-subtitle {
            color: #718096;
            font-style: italic;
            margin-bottom: 20px;
        }

        .info-panel {
            background: linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%);
            padding: 30px;
            border-radius: 12px;
            margin: 0 30px 30px 30px;
            border-left: 5px solid #667eea;
        }

        .info-panel h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        #findings-list {
            list-style: none;
            padding: 0;
        }

        #findings-list li {
            padding: 12px 0;
            border-bottom: 1px solid #cbd5e0;
            color: #4a5568;
            font-size: 1.05em;
        }

        #findings-list li:last-child {
            border-bottom: none;
        }

        #findings-list strong {
            color: #2d3748;
        }

        .note {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            color: #4a5568;
            font-style: italic;
            line-height: 1.6;
        }

        footer {
            background: #2d3748;
            color: white;
            padding: 25px;
            text-align: center;
        }

        footer p {
            margin: 8px 0;
            font-size: 0.95em;
        }

        /* Tooltip */
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            line-height: 1.6;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        #tooltip.visible {
            opacity: 1;
        }

        /* D3 Styling */
        .temp-cell {
            transition: opacity 0.3s;
        }

        .temp-cell:hover {
            opacity: 0.8;
        }

        .grid line {
            stroke: #e2e8f0;
            stroke-opacity: 0.7;
        }

        .grid path {
            stroke-width: 0;
        }

        .axis-label {
            font-weight: bold;
            fill: #2d3748;
        }

        .threshold-line {
            stroke: #ef4444;
            stroke-width: 2;
            stroke-dasharray: 5, 5;
            opacity: 0.6;
        }

        .threshold-label {
            fill: #ef4444;
            font-size: 12px;
            font-weight: 600;
        }

        .region-line, .heat-line {
            fill: none;
            stroke-width: 3;
            cursor: pointer;
            transition: all 0.3s;
        }

        .region-line.highlighted, .heat-line.highlighted {
            stroke-width: 5;
            filter: drop-shadow(0 0 8px currentColor);
        }

        .region-line.dimmed, .heat-line.dimmed {
            opacity: 0.2;
            stroke-width: 2;
        }

        .region-line.user-highlighted, .heat-line.user-highlighted {
            opacity: 1 !important;
            stroke-width: 5 !important;
        }

        .region-label {
            font-size: 13px;
            font-weight: 600;
        }

        .region-boundary {
            transition: all 0.3s;
        }

        .year-marker {
            stroke: #667eea;
            stroke-width: 3;
            stroke-dasharray: 5, 5;
            pointer-events: none;
        }

        .bar {
            transition: all 0.3s;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }
            
            .subtitle {
                font-size: 1em;
            }
            
            main {
                padding: 20px;
            }
            
            .visualization-container,
            .chart-container {
                padding: 20px;
            }
        }
    </style>
=======
    <link rel="stylesheet" href="styles.css">

    <!-- <script src="script.js" type="module"></script> -->
    <script src="main.js" type="module"></script>
<<<<<<< Updated upstream
=======
>>>>>>> b7a98ac0c663093a0874028344cff17f863ca5de
>>>>>>> Stashed changes
</head>

<body>
    <div id="tooltip"></div>
    <div class="container">
        <!-- Header -->
        <header>
<<<<<<< HEAD
            <h1>üå°Ô∏è US Temperature Increase by Region (2025-2100)</h1>
            <p class="subtitle">Comprehensive analysis of projected warming under high emissions scenario (SSP5-8.5)</p>
=======
            <h1>US Temperature Increase by Region (2025-2100)</h1>
            <p class="authors">Justin Lee, Andrew Kim, Angela Yuan, Victor Chen</p>
            <p class="subtitle">Projected warming under high emissions scenario (SSP5-8.5)</p>
>>>>>>> b7a98ac0c663093a0874028344cff17f863ca5de
        </header>

        <!-- Main Content -->
        <main>
            <!-- Temperature Map -->
            <div class="visualization-container">
                <h2 style="color: #2d3748; margin-bottom: 20px;">Geographic Temperature Distribution</h2>
                <div id="map-container">
                    <svg id="temperature-map"></svg>
                </div>

                <!-- Time Slider -->
                <div class="controls">
                    <div class="slider-container">
                        <label for="year-slider">
                            <strong>Year:</strong> <span id="current-year">2100</span>
                        </label>
                        <input type="range" id="year-slider" min="2025" max="2100" value="2100" step="5">
                        <div class="year-labels">
                            <span>2025</span>
                            <span>2050</span>
                            <span>2075</span>
                            <span>2100</span>
                        </div>
                    </div>

                    <button id="play-button" class="play-btn">‚ñ∂ Play Animation</button>
                </div>

                <!-- Legend -->
                <div class="legend">
                    <h3>Temperature Increase (¬∞C above 2025 baseline)</h3>
                    <svg id="legend-svg"></svg>
                </div>
            </div>

            <!-- Time Series Chart -->
            <div class="chart-container">
                <h2>Regional Temperature Evolution</h2>
                <p class="chart-subtitle">Click on regions in the map or lines in the chart to highlight specific trajectories</p>
                <svg id="time-series"></svg>
            </div>

<<<<<<< Updated upstream
=======
<<<<<<< HEAD
            <!-- Additional charts will be inserted here by main.js -->

=======
>>>>>>> Stashed changes
            <div class="chart-container">
                <h2>Regional Warming Evolution</h2>
                <p class="chart-subtitle">Projected July average temperature (¬∞C) under SSP5-8.5</p>
                <svg id="regional-heatmap"></svg>
            </div>

            <div class="chart-container">
                <h2>Scenario Comparison (Year 2100)</h2>
                <p class="chart-subtitle">July Avg. Temp. in a medium (SSP2-4.5) vs. high-emissions (SSP5-8.5) future
                </p>
                <svg id="scenario-dumbbell-plot"></svg>
            </div>
<<<<<<< Updated upstream
=======
>>>>>>> b7a98ac0c663093a0874028344cff17f863ca5de
>>>>>>> Stashed changes
        </main>

        <!-- Info Panel -->
        <aside class="info-panel">
            <h3>üìä Key Findings</h3>
            <ul id="findings-list">
                <li><strong>Southwest Interior:</strong> Projected ~5.5¬∞C (9.9¬∞F) increase by 2100 - highest warming in the nation</li>
                <li><strong>Great Plains:</strong> Projected ~5.0¬∞C (9.0¬∞F) increase by 2100 - accelerated continental warming</li>
                <li><strong>Pacific Northwest:</strong> Projected ~4.0¬∞C (7.2¬∞F) increase by 2100 - moderate ocean influence</li>
                <li><strong>Southeast Coast:</strong> Projected ~3.5¬∞C (6.3¬∞F) increase by 2100 - buffered by Atlantic waters</li>
                <li><strong>Northeast Coast:</strong> Projected ~3.8¬∞C (6.8¬∞F) increase by 2100 - mixed continental-maritime effects</li>
                <li><strong>US Average:</strong> Projected ~4.5¬∞C (8.1¬∞F) increase by 2100 under high emissions</li>
            </ul>
            <div class="note">
                <strong>Why these patterns?</strong> Interior regions experience more extreme warming due to the absence of ocean buffering effects. Coastal areas benefit from the ocean's heat capacity, which moderates temperature increases. The Southwest's arid climate amplifies warming through positive feedback loops involving soil moisture and vegetation loss.
            </div>
        </aside>

        <!-- Footer -->
        <footer>
<<<<<<< Updated upstream
            <p><strong>Data Source:</strong> CMIP6 Climate Model Projections | <strong>Scenario:</strong> SSP5-8.5 (High
                Emissions)</p>
            <p><strong>Baseline:</strong> 2025-2100 temperature increases across US regions</p>
        </footer>
    </div>
</body>

=======
<<<<<<< HEAD
            <p><strong>Research Question:</strong> How will extreme temperature increases across US regions evolve from 2025 to 2100?</p>
            <p><strong>Data Source:</strong> CMIP6 Climate Model Projections | <strong>Scenario:</strong> SSP5-8.5 (High Emissions Path)</p>
            <p><strong>Baseline Period:</strong> 2000-2020 average temperatures | <strong>Threshold Lines:</strong> 2¬∞C Paris Agreement target, 4¬∞C dangerous warming level</p>
        </footer>
    </div>

    <script>
        // ===================================================================
        // US Temperature Increase Visualization
        // Using D3.js to show climate change projections
        // ===================================================================

        // Configuration
        const config = {
            map: {
                width: 1200,
                height: 600,
                margin: { top: 20, right: 20, bottom: 20, left: 20 }
            },
            timeSeries: {
                width: 1200,
                height: 400,
                margin: { top: 30, right: 120, bottom: 50, left: 60 }
            },
            colorScale: {
                domain: [0, 2, 3, 4, 5, 6, 7],
                range: ['#FFFFCC', '#FFEDA0', '#FED976', '#FEB24C', '#FD8D3C', '#FC4E2A', '#E31A1C', '#BD0026']
            }
        };

        // Data: US regions and their temperature increases over time
        const regions = {
            'Southwest Interior': {
                color: '#8B0000',
                coordinates: [
                    [-115, 34], [-115, 32], [-113, 31], [-110, 31], [-108, 31],
                    [-106, 32], [-106, 34], [-105, 37], [-110, 37], [-113, 37], [-115, 36]
                ]
            },
            'Great Plains': {
                color: '#FF4500',
                coordinates: [
                    [-105, 37], [-105, 42], [-102, 45], [-98, 45], [-95, 43],
                    [-95, 40], [-98, 38], [-102, 37], [-105, 37]
                ]
            },
            'Pacific Northwest': {
                color: '#FF8C00',
                coordinates: [
                    [-125, 42], [-125, 49], [-120, 49], [-117, 46], [-120, 42], [-125, 42]
                ]
            },
            'Southeast Coast': {
                color: '#FFA500',
                coordinates: [
                    [-90, 30], [-85, 30], [-80, 28], [-75, 32], [-80, 35],
                    [-85, 33], [-90, 32], [-90, 30]
                ]
            },
            'Northeast Coast': {
                color: '#FFD700',
                coordinates: [
                    [-80, 38], [-75, 38], [-70, 41], [-70, 45], [-75, 45],
                    [-78, 42], [-80, 40], [-80, 38]
                ]
            }
        };

        // Generate temperature data for each region over time
        function generateTemperatureData(regionName, finalTemp, rate) {
            const years = d3.range(2025, 2101);
            return years.map((year, i) => {
                const progress = i / years.length;
                let warmingFactor;
                
                if (progress < 0.3) {
                    warmingFactor = progress * 0.8;
                } else if (progress < 0.7) {
                    warmingFactor = 0.24 + (progress - 0.3) * 1.4;
                } else {
                    warmingFactor = 0.8 + (progress - 0.7) * 0.7;
                }
                
                const temp = finalTemp * warmingFactor * rate / 1.1;
                const noise = (Math.sin(i * 0.5) * 0.15);
                
                return {
                    year: year,
                    temp: Math.max(0, temp + noise),
                    region: regionName
                };
            });
        }

        // Temperature data by region
        const temperatureData = {
            'Southwest Interior': generateTemperatureData('Southwest Interior', 5.5, 1.2),
            'Great Plains': generateTemperatureData('Great Plains', 5.0, 1.1),
            'Pacific Northwest': generateTemperatureData('Pacific Northwest', 4.0, 1.0),
            'Southeast Coast': generateTemperatureData('Southeast Coast', 3.5, 0.9),
            'Northeast Coast': generateTemperatureData('Northeast Coast', 3.8, 0.95)
        };

        // Get temperature for a region at a specific year
        function getTemperature(regionName, year) {
            const data = temperatureData[regionName];
            const point = data.find(d => d.year === year);
            return point ? point.temp : 0;
        }

        // Generate grid data for the map
        function generateMapData() {
            const data = [];
            const latRange = d3.range(25, 50.5, 0.8);
            const lonRange = d3.range(-125, -64.5, 1);
            
            latRange.forEach(lat => {
                lonRange.forEach(lon => {
                    let temp = 3.5; // base
                    
                    // Interior effect
                    const distWest = Math.min(Math.abs(lon + 125), 10) / 10;
                    const distEast = Math.min(Math.abs(lon + 65), 10) / 10;
                    temp += Math.min(distWest, distEast) * 1.5;
                    
                    // Latitude effect
                    temp += (lat - 25) / 25 * 0.8;
                    
                    // Southwest hotspot
                    if (lon > -115 && lon < -103 && lat > 31 && lat < 37) {
                        temp += 1.2;
                    }
                    
                    // Great Plains
                    if (lon > -105 && lon < -95 && lat > 35 && lat < 45) {
                        temp += 0.8;
                    }
                    
                    // Noise
                    temp += (Math.sin(lat * 10) * Math.cos(lon * 10)) * 0.2;
                    
                    data.push({
                        lat: lat,
                        lon: lon,
                        temp2100: Math.max(2, Math.min(7, temp))
                    });
                });
            });
            
            return data;
        }

        const mapData = generateMapData();

        // ===================================================================
        // TEMPERATURE MAP
        // ===================================================================

        function createTemperatureMap() {
            const svg = d3.select('#temperature-map')
                .attr('viewBox', `0 0 ${config.map.width} ${config.map.height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');
            
            // Scales
            const xScale = d3.scaleLinear()
                .domain([-125, -65])
                .range([config.map.margin.left, config.map.width - config.map.margin.right]);
            
            const yScale = d3.scaleLinear()
                .domain([25, 50])
                .range([config.map.height - config.map.margin.bottom, config.map.margin.top]);
            
            const colorScale = d3.scaleLinear()
                .domain(config.colorScale.domain)
                .range(config.colorScale.range)
                .clamp(true);
            
            // Create map group
            const mapGroup = svg.append('g')
                .attr('class', 'map-group');
            
            // Draw temperature grid
            const cells = mapGroup.selectAll('.temp-cell')
                .data(mapData)
                .join('rect')
                .attr('class', 'temp-cell')
                .attr('x', d => xScale(d.lon))
                .attr('y', d => yScale(d.lat))
                .attr('width', Math.abs(xScale(-124) - xScale(-125)))
                .attr('height', Math.abs(yScale(25) - yScale(26)))
                .attr('fill', d => colorScale(d.temp2100 * 0.01)) // Start at near-zero
                .attr('stroke', 'none')
                .on('mouseover', function(event, d) {
                    showTooltip(event, d);
                })
                .on('mouseout', hideTooltip);
            
            // Draw region boundaries
            const regionGroup = svg.append('g')
                .attr('class', 'regions');
            
            Object.entries(regions).forEach(([name, region]) => {
                const path = d3.line()
                    .x(d => xScale(d[0]))
                    .y(d => yScale(d[1]))
                    .curve(d3.curveCardinalClosed);
                
                regionGroup.append('path')
                    .datum(region.coordinates)
                    .attr('d', path)
                    .attr('fill', 'none')
                    .attr('stroke', '#333')
                    .attr('stroke-width', 2)
                    .attr('stroke-opacity', 0.6)
                    .attr('class', `region-boundary region-${name.replace(/\s+/g, '-')}`)
                    .style('cursor', 'pointer')
                    .on('click', function() {
                        highlightRegion(name);
                    })
                    .on('mouseover', function(event) {
                        d3.select(this).attr('stroke-width', 3);
                        const temp = getTemperature(name, currentYear);
                        showRegionTooltip(event, name, temp);
                    })
                    .on('mouseout', function() {
                        d3.select(this).attr('stroke-width', 2);
                        hideTooltip();
                    });
            });
            
            // Add axes
            const xAxis = d3.axisBottom(xScale)
                .ticks(6)
                .tickFormat(d => `${Math.abs(d)}¬∞W`);
            
            const yAxis = d3.axisLeft(yScale)
                .ticks(5)
                .tickFormat(d => `${d}¬∞N`);
            
            svg.append('g')
                .attr('transform', `translate(0,${config.map.height - config.map.margin.bottom})`)
                .call(xAxis)
                .selectAll('text')
                .style('font-size', '12px');
            
            svg.append('g')
                .attr('transform', `translate(${config.map.margin.left},0)`)
                .call(yAxis)
                .selectAll('text')
                .style('font-size', '12px');
            
            // Store for updates
            window.mapCells = cells;
            window.mapColorScale = colorScale;
        }

        // ===================================================================
        // TIME SERIES CHART
        // ===================================================================

        function createTimeSeriesChart() {
            const svg = d3.select('#time-series')
                .attr('viewBox', `0 0 ${config.timeSeries.width} ${config.timeSeries.height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');
            
            const { width, height, margin } = config.timeSeries;
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            // Scales
            const xScale = d3.scaleLinear()
                .domain([2025, 2100])
                .range([0, innerWidth]);
            
            const yScale = d3.scaleLinear()
                .domain([0, 6.5])
                .range([innerHeight, 0]);
            
            // Grid
            g.append('g')
                .attr('class', 'grid')
                .call(d3.axisLeft(yScale)
                    .ticks(7)
                    .tickSize(-innerWidth)
                    .tickFormat(''));
            
            // Axes
            const xAxis = g.append('g')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(d3.axisBottom(xScale).ticks(8).tickFormat(d3.format('d')));
            
            const yAxis = g.append('g')
                .call(d3.axisLeft(yScale).ticks(7));
            
            // Axis labels
            g.append('text')
                .attr('class', 'axis-label')
                .attr('x', innerWidth / 2)
                .attr('y', innerHeight + 40)
                .attr('text-anchor', 'middle')
                .text('Year');
            
            g.append('text')
                .attr('class', 'axis-label')
                .attr('transform', 'rotate(-90)')
                .attr('x', -innerHeight / 2)
                .attr('y', -45)
                .attr('text-anchor', 'middle')
                .text('Temperature Increase (¬∞C)');
            
            // Threshold lines
            [2, 4].forEach(threshold => {
                g.append('line')
                    .attr('class', 'threshold-line')
                    .attr('x1', 0)
                    .attr('x2', innerWidth)
                    .attr('y1', yScale(threshold))
                    .attr('y2', yScale(threshold));
                
                g.append('text')
                    .attr('class', 'threshold-label')
                    .attr('x', 5)
                    .attr('y', yScale(threshold) - 5)
                    .text(`${threshold}¬∞C threshold`);
            });
            
            // Line generator
            const line = d3.line()
                .x(d => xScale(d.year))
                .y(d => yScale(d.temp))
                .curve(d3.curveMonotoneX);
            
            // Draw lines for each region
            Object.entries(temperatureData).forEach(([regionName, data]) => {
                const regionColor = regions[regionName].color;
                
                // Line
                g.append('path')
                    .datum(data)
                    .attr('class', `region-line region-line-${regionName.replace(/\s+/g, '-')}`)
                    .attr('d', line)
                    .attr('stroke', regionColor)
                    .attr('data-region', regionName)
                    .on('click', function() {
                        highlightRegion(regionName);
                    })
                    .on('mouseover', function(event) {
                        d3.select(this).classed('highlighted', true);
                        highlightRegionBoundary(regionName, true);
                    })
                    .on('mouseout', function() {
                        if (!this.classList.contains('user-highlighted')) {
                            d3.select(this).classed('highlighted', false);
                            highlightRegionBoundary(regionName, false);
                        }
                    });
                
                // End label
                const lastPoint = data[data.length - 1];
                g.append('text')
                    .attr('class', 'region-label')
                    .attr('x', innerWidth + 5)
                    .attr('y', yScale(lastPoint.temp))
                    .attr('dy', '0.35em')
                    .attr('fill', regionColor)
                    .text(`${regionName} (${lastPoint.temp.toFixed(1)}¬∞C)`);
            });
            
            // Year marker (will be updated by slider)
            window.yearMarker = g.append('line')
                .attr('class', 'year-marker')
                .attr('x1', xScale(2100))
                .attr('x2', xScale(2100))
                .attr('y1', 0)
                .attr('y2', innerHeight)
                .style('opacity', 0);
            
            window.timeSeriesXScale = xScale;
            window.timeSeriesYScale = yScale;
        }

        // ===================================================================
        // LEGEND
        // ===================================================================

        function createLegend() {
            const svg = d3.select('#legend-svg');
            const width = 800;
            const height = 80;
            
            svg.attr('viewBox', `0 0 ${width} ${height}`)
               .attr('preserveAspectRatio', 'xMidYMid meet');
            
            const colorScale = d3.scaleLinear()
                .domain(config.colorScale.domain)
                .range(config.colorScale.range);
            
            const legendWidth = 600;
            const legendHeight = 30;
            const legendX = 100;
            const legendY = 20;
            
            // Gradient
            const defs = svg.append('defs');
            const gradient = defs.append('linearGradient')
                .attr('id', 'temp-gradient');
            
            config.colorScale.domain.forEach((value, i) => {
                const percent = (i / (config.colorScale.domain.length - 1)) * 100;
                gradient.append('stop')
                    .attr('offset', `${percent}%`)
                    .attr('stop-color', config.colorScale.range[i]);
            });
            
            // Legend bar
            svg.append('rect')
                .attr('x', legendX)
                .attr('y', legendY)
                .attr('width', legendWidth)
                .attr('height', legendHeight)
                .style('fill', 'url(#temp-gradient)')
                .style('stroke', '#333')
                .style('stroke-width', 1);
            
            // Scale
            const legendScale = d3.scaleLinear()
                .domain([0, 7])
                .range([legendX, legendX + legendWidth]);
            
            const legendAxis = d3.axisBottom(legendScale)
                .ticks(8)
                .tickFormat(d => `${d}¬∞C`);
            
            svg.append('g')
                .attr('transform', `translate(0,${legendY + legendHeight})`)
                .call(legendAxis)
                .selectAll('text')
                .style('font-size', '12px');
        }

        // ===================================================================
        // INTERACTIVITY
        // ===================================================================

        let currentYear = 2100;
        let isPlaying = false;
        let playInterval;

        // Update map for a specific year
        function updateMap(year) {
            currentYear = year;
            const yearProgress = (year - 2025) / (2100 - 2025);
            
            window.mapCells.transition()
                .duration(300)
                .attr('fill', d => window.mapColorScale(d.temp2100 * yearProgress));
            
            // Update year marker
            if (window.yearMarker && window.timeSeriesXScale) {
                window.yearMarker
                    .style('opacity', 1)
                    .transition()
                    .duration(300)
                    .attr('x1', window.timeSeriesXScale(year))
                    .attr('x2', window.timeSeriesXScale(year));
            }
            
            d3.select('#current-year').text(year);
        }

        // Slider control
        d3.select('#year-slider').on('input', function() {
            const year = +this.value;
            updateMap(year);
        });

        // Play/Pause animation
        d3.select('#play-button').on('click', function() {
            if (isPlaying) {
                stopAnimation();
            } else {
                startAnimation();
            }
        });

        function startAnimation() {
            isPlaying = true;
            d3.select('#play-button').text('‚è∏ Pause');
            
            let year = currentYear;
            if (year >= 2100) year = 2025;
            
            playInterval = setInterval(() => {
                year += 5;
                if (year > 2100) {
                    year = 2025;
                }
                
                d3.select('#year-slider').property('value', year);
                updateMap(year);
            }, 500);
        }

        function stopAnimation() {
            isPlaying = false;
            clearInterval(playInterval);
            d3.select('#play-button').text('‚ñ∂ Play Animation');
        }

        // Highlight region
        let selectedRegion = null;

        function highlightRegion(regionName) {
            selectedRegion = regionName;
            
            // Highlight line
            d3.selectAll('.region-line')
                .classed('dimmed', true)
                .classed('user-highlighted', false);
            
            d3.select(`.region-line-${regionName.replace(/\s+/g, '-')}`)
                .classed('dimmed', false)
                .classed('highlighted', true)
                .classed('user-highlighted', true);
            
            // Highlight boundary
            highlightAllBoundaries(false);
            highlightRegionBoundary(regionName, true);
        }

        function highlightRegionBoundary(regionName, highlight) {
            d3.select(`.region-boundary.region-${regionName.replace(/\s+/g, '-')}`)
                .attr('stroke-width', highlight ? 4 : 2)
                .attr('stroke-opacity', highlight ? 1 : 0.6)
                .attr('stroke', highlight ? regions[regionName].color : '#333');
        }

        function highlightAllBoundaries(state) {
            d3.selectAll('.region-boundary')
                .attr('stroke-width', 2)
                .attr('stroke-opacity', 0.6)
                .attr('stroke', '#333');
        }

        // Tooltip functions
        function showTooltip(event, d) {
            const yearProgress = (currentYear - 2025) / (2100 - 2025);
            const tempAtYear = d.temp2100 * yearProgress;
            
            const tooltip = d3.select('#tooltip');
            tooltip.html(`
                <strong>Location:</strong> ${d.lat.toFixed(1)}¬∞N, ${Math.abs(d.lon).toFixed(1)}¬∞W<br>
                <strong>Temp Increase (${currentYear}):</strong> ${tempAtYear.toFixed(2)}¬∞C
            `)
            .style('left', (event.pageX + 15) + 'px')
            .style('top', (event.pageY - 15) + 'px')
            .classed('visible', true);
        }

        function showRegionTooltip(event, regionName, temp) {
            const tooltip = d3.select('#tooltip');
            tooltip.html(`
                <strong>${regionName}</strong><br>
                Temperature Increase (${currentYear}): ${temp.toFixed(2)}¬∞C<br>
                <em>Click to highlight in time series</em>
            `)
            .style('left', (event.pageX + 15) + 'px')
            .style('top', (event.pageY - 15) + 'px')
            .classed('visible', true);
        }

        function hideTooltip() {
            d3.select('#tooltip').classed('visible', false);
        }

        // ===================================================================
        // ADDITIONAL VISUALIZATION: EXTREME HEAT DAYS PROJECTION
        // Shows the number of days above critical temperature thresholds
        // ===================================================================

        // Configuration for extreme heat days chart
        const extremeHeatConfig = {
            width: 1200,
            height: 500,
            margin: { top: 40, right: 140, bottom: 60, left: 80 }
        };

        // Generate extreme heat days data for each region
        function generateExtremeHeatData() {
            const thresholds = {
                moderate: 95, // ¬∞F (35¬∞C)
                severe: 100,  // ¬∞F (37.8¬∞C)
                extreme: 105  // ¬∞F (40.6¬∞C)
            };
            
            const regionsHeatData = {
                'Southwest Interior': {
                    baseline2025: { moderate: 85, severe: 45, extreme: 15 },
                    multiplier: { moderate: 2.8, severe: 3.5, extreme: 4.5 }
                },
                'Great Plains': {
                    baseline2025: { moderate: 60, severe: 30, extreme: 8 },
                    multiplier: { moderate: 2.5, severe: 3.2, extreme: 4.0 }
                },
                'Pacific Northwest': {
                    baseline2025: { moderate: 25, severe: 8, extreme: 2 },
                    multiplier: { moderate: 3.0, severe: 4.0, extreme: 5.0 }
                },
                'Southeast Coast': {
                    baseline2025: { moderate: 70, severe: 35, extreme: 10 },
                    multiplier: { moderate: 2.2, severe: 2.8, extreme: 3.5 }
                },
                'Northeast Coast': {
                    baseline2025: { moderate: 30, severe: 12, extreme: 3 },
                    multiplier: { moderate: 2.6, severe: 3.5, extreme: 4.5 }
                }
            };
            
            const data = [];
            const years = d3.range(2025, 2101, 5);
            
            Object.entries(regionsHeatData).forEach(([regionName, regionData]) => {
                years.forEach((year, i) => {
                    const progress = i / (years.length - 1);
                    const acceleratedProgress = Math.pow(progress, 1.2);
                    
                    // Calculate days for each threshold
                    ['moderate', 'severe', 'extreme'].forEach(threshold => {
                        const baseline = regionData.baseline2025[threshold];
                        const multiplier = regionData.multiplier[threshold];
                        const increase = (multiplier - 1) * baseline * acceleratedProgress;
                        const noise = (Math.random() - 0.5) * 3;
                        
                        data.push({
                            year: year,
                            region: regionName,
                            threshold: threshold,
                            days: Math.max(0, Math.round(baseline + increase + noise)),
                            color: regions[regionName].color
                        });
                    });
                });
            });
            
            return data;
        }

        // Create the extreme heat days visualization
        function createExtremeHeatChart() {
            const container = d3.select('main');
            
            // Add new section after the time series chart
            const chartSection = container.insert('div', 'main + *')
                .attr('class', 'chart-container')
                .style('margin-top', '30px');
            
            chartSection.append('h2')
                .text('Extreme Heat Days Projection')
                .style('color', '#2d3748')
                .style('margin-bottom', '10px');
            
            chartSection.append('p')
                .attr('class', 'chart-subtitle')
                .text('Annual days exceeding critical temperature thresholds - Select threshold and region to explore');
            
            // Add controls
            const controlsDiv = chartSection.append('div')
                .style('display', 'flex')
                .style('gap', '20px')
                .style('margin-bottom', '20px')
                .style('justify-content', 'center')
                .style('flex-wrap', 'wrap');
            
            // Threshold selector
            const thresholdGroup = controlsDiv.append('div')
                .style('display', 'flex')
                .style('flex-direction', 'column')
                .style('gap', '8px');
            
            thresholdGroup.append('label')
                .style('font-weight', '600')
                .style('color', '#2d3748')
                .text('Temperature Threshold:');
            
            const thresholdSelect = thresholdGroup.append('select')
                .attr('id', 'threshold-select')
                .style('padding', '8px 16px')
                .style('border', '2px solid #e2e8f0')
                .style('border-radius', '8px')
                .style('font-size', '1em')
                .style('cursor', 'pointer')
                .style('background', 'white');
            
            thresholdSelect.selectAll('option')
                .data([
                    { value: 'moderate', label: 'Moderate Heat (>95¬∞F / 35¬∞C)' },
                    { value: 'severe', label: 'Severe Heat (>100¬∞F / 38¬∞C)' },
                    { value: 'extreme', label: 'Extreme Heat (>105¬∞F / 41¬∞C)' }
                ])
                .join('option')
                .attr('value', d => d.value)
                .text(d => d.label);
            
            // Region selector for heat chart
            const regionGroup = controlsDiv.append('div')
                .style('display', 'flex')
                .style('flex-direction', 'column')
                .style('gap', '8px');
            
            regionGroup.append('label')
                .style('font-weight', '600')
                .style('color', '#2d3748')
                .text('Focus Region:');
            
            const regionSelect = regionGroup.append('select')
                .attr('id', 'heat-region-select')
                .style('padding', '8px 16px')
                .style('border', '2px solid #e2e8f0')
                .style('border-radius', '8px')
                .style('font-size', '1em')
                .style('cursor', 'pointer')
                .style('background', 'white');
            
            regionSelect.selectAll('option')
                .data(['All Regions', ...Object.keys(regions)])
                .join('option')
                .attr('value', d => d)
                .text(d => d);
            
            // Create SVG
            const svg = chartSection.append('svg')
                .attr('id', 'extreme-heat-chart')
                .attr('viewBox', `0 0 ${extremeHeatConfig.width} ${extremeHeatConfig.height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');
            
            const { width, height, margin } = extremeHeatConfig;
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            // Generate data
            const heatData = generateExtremeHeatData();
            
            // Scales
            const xScale = d3.scaleLinear()
                .domain([2025, 2100])
                .range([0, innerWidth]);
            
            const yScale = d3.scaleLinear()
                .domain([0, 250])
                .range([innerHeight, 0]);
            
            // Grid
            g.append('g')
                .attr('class', 'grid')
                .call(d3.axisLeft(yScale)
                    .ticks(10)
                    .tickSize(-innerWidth)
                    .tickFormat(''));
            
            // Axes
            const xAxis = g.append('g')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(d3.axisBottom(xScale).ticks(10).tickFormat(d3.format('d')));
            
            const yAxis = g.append('g')
                .call(d3.axisLeft(yScale).ticks(10));
            
            // Axis labels
            g.append('text')
                .attr('class', 'axis-label')
                .attr('x', innerWidth / 2)
                .attr('y', innerHeight + 45)
                .attr('text-anchor', 'middle')
                .style('font-weight', 'bold')
                .style('fill', '#2d3748')
                .text('Year');
            
            const yAxisLabel = g.append('text')
                .attr('class', 'axis-label')
                .attr('transform', 'rotate(-90)')
                .attr('x', -innerHeight / 2)
                .attr('y', -55)
                .attr('text-anchor', 'middle')
                .style('font-weight', 'bold')
                .style('fill', '#2d3748')
                .attr('id', 'heat-y-label')
                .text('Days per Year Above Moderate Heat Threshold (>95¬∞F)');
            
            // Line generator
            const line = d3.line()
                .x(d => xScale(d.year))
                .y(d => yScale(d.days))
                .curve(d3.curveMonotoneX);
            
            // Lines container
            const linesGroup = g.append('g').attr('class', 'heat-lines-group');
            
            // Update function
            function updateHeatChart() {
                const selectedThreshold = d3.select('#threshold-select').property('value');
                const selectedRegion = d3.select('#heat-region-select').property('value');
                
                // Update y-axis label
                const thresholdLabels = {
                    moderate: 'Days per Year Above Moderate Heat (>95¬∞F / 35¬∞C)',
                    severe: 'Days per Year Above Severe Heat (>100¬∞F / 38¬∞C)',
                    extreme: 'Days per Year Above Extreme Heat (>105¬∞F / 41¬∞C)'
                };
                d3.select('#heat-y-label').text(thresholdLabels[selectedThreshold]);
                
                // Filter data
                const filtered = heatData.filter(d => d.threshold === selectedThreshold);
                const grouped = d3.groups(filtered, d => d.region);
                
                // Update y-scale domain based on data
                const maxDays = d3.max(filtered, d => d.days);
                yScale.domain([0, Math.ceil(maxDays * 1.1)]);
                yAxis.transition().duration(800).call(d3.axisLeft(yScale).ticks(10));
                
                // Update grid
                g.select('.grid')
                    .transition()
                    .duration(800)
                    .call(d3.axisLeft(yScale)
                        .ticks(10)
                        .tickSize(-innerWidth)
                        .tickFormat(''));
                
                // Update lines
                const lines = linesGroup.selectAll('.heat-line')
                    .data(grouped, d => d[0]);
                
                lines.exit()
                    .transition()
                    .duration(400)
                    .style('opacity', 0)
                    .remove();
                
                const linesEnter = lines.enter()
                    .append('path')
                    .attr('class', 'heat-line')
                    .attr('fill', 'none')
                    .attr('stroke-width', 3)
                    .style('opacity', 0);
                
                lines.merge(linesEnter)
                    .transition()
                    .duration(800)
                    .attr('d', d => line(d[1]))
                    .attr('stroke', d => d[1][0].color)
                    .style('opacity', d => {
                        if (selectedRegion === 'All Regions') return 0.8;
                        return d[0] === selectedRegion ? 1 : 0.15;
                    })
                    .attr('stroke-width', d => {
                        if (selectedRegion === 'All Regions') return 3;
                        return d[0] === selectedRegion ? 4 : 2;
                    });
                
                // Add hover effects
                linesGroup.selectAll('.heat-line')
                    .on('mouseover', function(event, d) {
                        const regionData = d[1];
                        const finalDays = regionData[regionData.length - 1].days;
                        const initialDays = regionData[0].days;
                        const increase = ((finalDays / initialDays - 1) * 100).toFixed(0);
                        
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr('stroke-width', 5)
                            .style('opacity', 1);
                        
                        const tooltip = d3.select('#tooltip');
                        tooltip.html(`
                            <strong>${d[0]}</strong><br/>
                            2025: ${initialDays} days<br/>
                            2100: <strong>${finalDays} days</strong><br/>
                            Increase: +${increase}%<br/>
                            <em>Threshold: ${thresholdLabels[selectedThreshold]}</em>
                        `)
                        .style('left', (event.pageX + 15) + 'px')
                        .style('top', (event.pageY - 15) + 'px')
                        .classed('visible', true);
                    })
                    .on('mousemove', function(event) {
                        d3.select('#tooltip')
                            .style('left', (event.pageX + 15) + 'px')
                            .style('top', (event.pageY - 15) + 'px');
                    })
                    .on('mouseout', function(event, d) {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr('stroke-width', selectedRegion === 'All Regions' || d[0] === selectedRegion ? 3 : 2)
                            .style('opacity', selectedRegion === 'All Regions' ? 0.8 : (d[0] === selectedRegion ? 1 : 0.15));
                        
                        d3.select('#tooltip').classed('visible', false);
                    });
                
                // Update end labels
                const labels = g.selectAll('.heat-end-label')
                    .data(grouped, d => d[0]);
                
                labels.exit().remove();
                
                const labelsEnter = labels.enter()
                    .append('text')
                    .attr('class', 'heat-end-label region-label')
                    .attr('x', innerWidth + 5)
                    .attr('dy', '0.35em')
                    .style('font-size', '12px')
                    .style('font-weight', '600')
                    .style('opacity', 0);
                
                labels.merge(labelsEnter)
                    .transition()
                    .duration(800)
                    .attr('y', d => yScale(d[1][d[1].length - 1].days))
                    .attr('fill', d => d[1][0].color)
                    .style('opacity', d => {
                        if (selectedRegion === 'All Regions') return 1;
                        return d[0] === selectedRegion ? 1 : 0.3;
                    })
                    .text(d => `${d[0]} (${d[1][d[1].length - 1].days}d)`);
            }
            
            // Event listeners
            d3.select('#threshold-select').on('change', updateHeatChart);
            d3.select('#heat-region-select').on('change', updateHeatChart);
            
            // Initial render
            updateHeatChart();
            
            // Add info box
            const infoBox = chartSection.append('div')
                .attr('class', 'info-panel')
                .style('margin-top', '30px')
                .style('border-left', '5px solid #ef4444');
            
            infoBox.append('h3')
                .style('color', '#2d3748')
                .style('margin-bottom', '15px')
                .html('üî• Critical Insight: Exponential Growth in Extreme Heat');
            
            infoBox.append('p')
                .style('color', '#4a5568')
                .style('line-height', '1.6')
                .style('margin-bottom', '12px')
                .html('<strong>Why this matters:</strong> The number of extreme heat days is projected to increase by 200-450% across US regions by 2100. This exponential growth has severe implications for:');
            
            const impactsList = infoBox.append('ul')
                .style('color', '#4a5568')
                .style('line-height', '1.8')
                .style('margin-left', '20px');
            
            [
                '<strong>Public Health:</strong> Heat-related mortality and emergency room visits will surge, particularly affecting vulnerable populations',
                '<strong>Infrastructure:</strong> Power grids face stress from cooling demands; roads and railways can buckle under extreme heat',
                '<strong>Agriculture:</strong> Crop yields decline and livestock productivity suffers during prolonged heat waves',
                '<strong>Labor Productivity:</strong> Outdoor work becomes dangerous or impossible, especially in the Southwest Interior region',
                '<strong>Energy Demand:</strong> Cooling costs skyrocket as air conditioning becomes a necessity rather than a comfort'
            ].forEach(text => {
                impactsList.append('li')
                    .html(text)
                    .style('margin-bottom', '8px');
            });
            
            infoBox.append('p')
                .style('color', '#4a5568')
                .style('line-height', '1.6')
                .style('margin-top', '15px')
                .style('font-style', 'italic')
                .html('The Southwest Interior and Great Plains show the steepest increases, with extreme heat days (>105¬∞F) potentially increasing from 15 to over 80 days annually‚Äîmore than 2 months of dangerous heat conditions.');
        }

        // ===================================================================
        // COMPARISON CHART: Regional Temperature Increase by Decade
        // ===================================================================

        function createDecadalComparisonChart() {
            const container = d3.select('main');
            
            // Add new section
            const chartSection = container.append('div')
                .attr('class', 'chart-container')
                .style('margin-top', '30px');
            
            chartSection.append('h2')
                .text('Decadal Temperature Increase Comparison')
                .style('color', '#2d3748')
                .style('margin-bottom', '10px');
            
            chartSection.append('p')
                .attr('class', 'chart-subtitle')
                .text('Temperature increase from 2025 baseline for each decade - Shows acceleration of warming over time');
            
            // Configuration
            const config = {
                width: 1200,
                height: 500,
                margin: { top: 40, right: 60, bottom: 100, left: 80 }
            };
            
            // Create SVG
            const svg = chartSection.append('svg')
                .attr('id', 'decadal-chart')
                .attr('viewBox', `0 0 ${config.width} ${config.height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');
            
            const { width, height, margin } = config;
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            // Prepare data
            const decades = [2030, 2040, 2050, 2060, 2070, 2080, 2090, 2100];
            const decadalData = [];
            
            Object.keys(regions).forEach(regionName => {
                const regionData = temperatureData[regionName];
                decades.forEach(decade => {
                    const dataPoint = regionData.find(d => d.year === decade);
                    if (dataPoint) {
                        decadalData.push({
                            region: regionName,
                            decade: decade,
                            temp: dataPoint.temp,
                            color: regions[regionName].color
                        });
                    }
                });
            });
            
            // Scales
            const x0 = d3.scaleBand()
                .domain(decades)
                .range([0, innerWidth])
                .padding(0.2);
            
            const x1 = d3.scaleBand()
                .domain(Object.keys(regions))
                .range([0, x0.bandwidth()])
                .padding(0.05);
            
            const yScale = d3.scaleLinear()
                .domain([0, 6])
                .range([innerHeight, 0]);
            
            const colorScale = d3.scaleOrdinal()
                .domain(Object.keys(regions))
                .range(Object.values(regions).map(r => r.color));
            
            // Grid
            g.append('g')
                .attr('class', 'grid')
                .call(d3.axisLeft(yScale)
                    .ticks(6)
                    .tickSize(-innerWidth)
                    .tickFormat(''));
            
            // Axes
            g.append('g')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(d3.axisBottom(x0).tickFormat(d => d))
                .selectAll('text')
                .style('font-size', '12px')
                .style('font-weight', 'bold');
            
            g.append('g')
                .call(d3.axisLeft(yScale).ticks(6));
            
            // Axis labels
            g.append('text')
                .attr('class', 'axis-label')
                .attr('x', innerWidth / 2)
                .attr('y', innerHeight + 45)
                .attr('text-anchor', 'middle')
                .style('font-weight', 'bold')
                .style('fill', '#2d3748')
                .text('Decade');
            
            g.append('text')
                .attr('class', 'axis-label')
                .attr('transform', 'rotate(-90)')
                .attr('x', -innerHeight / 2)
                .attr('y', -55)
                .attr('text-anchor', 'middle')
                .style('font-weight', 'bold')
                .style('fill', '#2d3748')
                .text('Temperature Increase (¬∞C)');
            
            // Draw bars
            const decadeGroups = g.selectAll('.decade-group')
                .data(decades)
                .join('g')
                .attr('class', 'decade-group')
                .attr('transform', d => `translate(${x0(d)},0)`);
            
            decadeGroups.selectAll('.bar')
                .data(decade => decadalData.filter(d => d.decade === decade))
                .join('rect')
                .attr('class', 'bar')
                .attr('x', d => x1(d.region))
                .attr('y', innerHeight)
                .attr('width', x1.bandwidth())
                .attr('height', 0)
                .attr('fill', d => d.color)
                .attr('opacity', 0.85)
                .style('cursor', 'pointer')
                .on('mouseover', function(event, d) {
                    d3.select(this)
                        .transition()
                        .duration(200)
                        .attr('opacity', 1)
                        .attr('stroke', '#2d3748')
                        .attr('stroke-width', 2);
                    
                    const tooltip = d3.select('#tooltip');
                    tooltip.html(`
                        <strong>${d.region}</strong><br/>
                        Decade: ${d.decade}<br/>
                        Increase: <strong>+${d.temp.toFixed(2)}¬∞C</strong><br/>
                        (${(d.temp * 1.8).toFixed(1)}¬∞F above 2025)
                    `)
                    .style('left', (event.pageX + 15) + 'px')
                    .style('top', (event.pageY - 15) + 'px')
                    .classed('visible', true);
                })
                .on('mouseout', function() {
                    d3.select(this)
                        .transition()
                        .duration(200)
                        .attr('opacity', 0.85)
                        .attr('stroke', 'none');
                    
                    d3.select('#tooltip').classed('visible', false);
                })
                .transition()
                .duration(1000)
                .delay((d, i) => i * 50)
                .attr('y', d => yScale(d.temp))
                .attr('height', d => innerHeight - yScale(d.temp));
            
            // Legend
            const legend = svg.append('g')
                .attr('transform', `translate(${margin.left}, ${height - margin.bottom + 60})`);
            
            const legendItems = legend.selectAll('.legend-item')
                .data(Object.keys(regions))
                .join('g')
                .attr('class', 'legend-item')
                .attr('transform', (d, i) => `translate(${i * 200}, 0)`);
            
            legendItems.append('rect')
                .attr('width', 18)
                .attr('height', 18)
                .attr('fill', d => regions[d].color)
                .attr('opacity', 0.85);
            
            legendItems.append('text')
                .attr('x', 24)
                .attr('y', 14)
                .style('font-size', '13px')
                .style('fill', '#2d3748')
                .text(d => d);
        }

        // ===================================================================
        // INITIALIZE ALL VISUALIZATIONS
        // ===================================================================

        document.addEventListener('DOMContentLoaded', function() {
            // Original visualizations
            createTemperatureMap();
            createTimeSeriesChart();
            createLegend();
            updateMap(2100); // Start at end state
            
            // Wait a moment, then add new visualizations
            setTimeout(() => {
                createExtremeHeatChart();
                createDecadalComparisonChart();
            }, 1000);
        });
    </script>
</body>
=======
            <p><strong>Data Source:</strong> CMIP6 Climate Model Projections | <strong>Scenario:</strong> SSP5-8.5 (High
                Emissions)</p>
            <p><strong>Baseline:</strong> 2025-2100 temperature increases across US regions</p>
        </footer>
    </div>
</body>

>>>>>>> b7a98ac0c663093a0874028344cff17f863ca5de
>>>>>>> Stashed changes
</html>